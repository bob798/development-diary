数据唯一性保证

1. 数据库索引

2. 软件代码

   1. redis set集合

   用Redis的Set集合实现起来更简单方便。键为日期，值为签到用户id的集合。然后通过sadd命令的返回值判断，返回1表示首次签到，0表示重复签到。Redis的Set集合的增、删、查的复杂度都是O(1)，比数据库的吞吐量要高得多了，而且成本是最低的。

   3、如果一定要用数据库，当活跃用户量达到千万级时，肯定要分库分表的。根据用户id取模使其落在不同的库或不同的表里。步骤：新建一个“签到”库，通过用户id%64可以分布到64张表。然后根据“冷热数据分离”原则，每个月用一张新表，新表用定时任务自动创建。超过3个月的历史签到数据用途不大了，可以直接转移到备份数据库里，保证当前库的数据总量不要太大。此时我们大概评估一下：假设活跃用户为1000万，一个月30天产生的签到数据量为3亿条，由于共有64张表，则落在每张表里的平均数据量约为468万左右。单表数据低于500万条，这量级对MySQL来讲毫无压力了。







# 参考

https://zhuanlan.zhihu.com/p/62539693 （评论区）

https://blog.csdn.net/App_Victim/article/details/78199672

